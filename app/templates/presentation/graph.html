<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>BleScan</title>
</head>

<body>
    <h1>Blescan Data</h1>
    <button onclick="window.location.href='/';">
        Back to frontpage</button>
    <br><br>


    <script src="https://unpkg.com/htmx.org@1.9.8"></script>
    <!-- use htmx to update table -->
    <button id="btnUpdate" onclick="fetchData()"> <!--hx-get="data_table" hx-swap="innerHTML" hx-target="#item_table"-->
        Update
    </button>

    <label>Last updated:</label>
    <label id="update_timestamp">XX</label> <br>

    <script>

        function updateData() {
            return;
            time = new Date().toLocaleTimeString();

            document.getElementById("btnUpdate").click();

            document.getElementById("update_timestamp").innerHTML = time;
        }

        updateData();
        setInterval(updateData, 5000);
    </script>


    <canvas id="myChart" style="width:100%;max-width:100%"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>

        chart = false;

        function setValues(data) {
            console.log("setting data: " + data);
            time = data.timestamp;
            count = data.count_avg;
            online = data.dev_count;

            console.log("data count: " + time.length);

            if (chart) {
                chart.destroy();
            }

            chart = new Chart("myChart", {
            type: "line",
            data: {
                labels: time,
                datasets: [{
                    label: "Total Count",
                    data: count,
                    borderColor: "red",
                    fill: true
                },
                {
                    label: "Devices Online",
                    data: online,
                    borderColor: "blue",
                    fill: false
                }
            ]
            },
            options: {
                legend: { display: true },
                animation: {
                    duration: 0
                },
                scales: {
                    x: {
                        ticks: {
                            autoSkip: true,
                            autoSkipPadding: time.length/10
                        }
                    }
                }
            }
        });

        }

        function fetchData() {
            console.log("fetching data");
            fetch('/database/data', {
                method: 'GET'
            })
            .then(response => response.json())
            .then(data => {
                setValues(data);
            }).catch(error => {
                console.error('Error:', error);
            })
        }
    </script>
</body>

</html>